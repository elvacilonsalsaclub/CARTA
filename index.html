<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>El Vacilón Salsa Club — Sistema</title>

  <!-- Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- SheetJS para leer XLSX -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>

  <!-- ========================= LOGIN ========================= -->
  <div id="login-stage">
    <div id="videoWrapper">
      <video id="bgVideo" autoplay muted loop playsinline>
        <source src="video_elvacilon1.mp4" type="video/mp4">
        Tu navegador no soporta video de fondo.
      </video>
    </div>

    <div id="loginOverlay" class="fade-in">
      <img id="logo" src="logo_elvacilon1.png" alt="Logo El Vacilón">
      <h1 id="brandTitle">El Vacilón <span>Salsa Club</span></h1>

      <div id="loginBox">
        <input id="inputUser" type="text" placeholder="Usuario (ej: alex)" autocomplete="username">
        <div class="pass-wrap">
          <input id="inputPass" type="password" placeholder="Contraseña" autocomplete="current-password">
          <button type="button" id="btnTogglePass" class="btn gold small" aria-label="Mostrar contraseña">👁️</button>
        </div>
        <div class="row">
          <button id="btnLogin" class="btn primary">Ingresar</button>
          <button id="btnDemo" class="btn ghost">Demo</button>
        </div>
        <p class="muted small">© 2025 El Vacilón Salsa Club — Carrera 23a #7A - 15 — @elvacilonclub</p>
      </div>
    </div>
  </div>

  <!-- ========================= APP ========================= -->
  <div id="app" class="hidden app-container">
    <header class="app-header">
      <div class="header-left">
        <img src="logo_elvacilon1.png" class="small-logo" alt="logo">
        <div>
          <div class="title">El Vacilón Salsa Club</div>
          <div id="userInfo" class="muted small"></div>
        </div>
      </div>

      <div class="header-right">
        <div id="clock" class="muted small">--:--:--</div>
        <div id="counters" class="muted small">Ocupadas: 0 / Libres: 32</div>

        <!-- Botones -->
        <button id="btnSelectDay" class="btn ghost hidden">Seleccione día</button>
        <button id="btnPrintPriceList" class="btn ghost">Imprimir lista</button>
        <button id="btnViewComandas" class="btn ghost hidden">Ver Comandas</button>
        <button id="btnViewHistory" class="btn ghost hidden">Historial de Cierres</button>
        <button id="btnExportCSV" class="btn ghost hidden">Exportar Cierre (CSV)</button>
        <button id="btnCloseDay" class="btn ghost hidden">Cerrar día</button>
        <button id="btnRestore" class="btn danger hidden">Restaurar sistema</button>
        <button id="btnLogout" class="btn danger">Salir</button>
      </div>
    </header>

    <main class="main-grid">
      <section class="left-panel">
        <div id="mesasContainer">
          <h3>Mesas y Barras</h3>
          <div id="tablesGrid" class="tables-grid"></div>
        </div>

        <div id="comandasContainer" class="hidden">
          <div class="toolbar">
            <h3>Comandas (Cajera)</h3>
            <div>
              <label><input type="radio" name="comFilter" value="all" checked> Todas</label>
              <label><input type="radio" name="comFilter" value="open"> Abiertas</label>
              <label><input type="radio" name="comFilter" value="closed"> Cerradas</label>
              <button id="btnBackToMesas" class="btn ghost">Volver a Mesas</button>
            </div>
          </div>
          <div id="comandasCounters" class="muted small">Abiertas: 0 / Cerradas: 0</div>
          <table id="comandasTable" class="striped">
            <thead><tr><th>Mesa</th><th>Mesero</th><th>Estado</th><th>Subtotal</th><th>Propina</th><th>Total</th><th>Fecha</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="historyContainer" class="hidden">
          <div class="toolbar">
            <h3>Historial de Cierres</h3>
            <button id="btnBackFromHistory" class="btn ghost">Volver a Mesas</button>
          </div>
          <div id="historyCounters" class="muted small">Registros: 0</div>
          <table id="historyTable" class="striped">
            <thead><tr><th>Fecha</th><th>Total Ventas</th><th>Comandas cerradas</th><th>Generado por</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <aside class="right-panel">
        <h3>Comanda</h3>
        <div id="noSession" class="panel">
          <p class="muted">No hay mesa abierta. Haga clic en una mesa.</p>
          <div class="row"><input id="manualTable" placeholder="Ej: 1, 1A, B1"><button id="btnOpenManual" class="btn primary">Abrir</button></div>
        </div>

        <div id="sessionPanel" class="panel hidden">
          <div class="session-header">
            <div>Mesa: <span id="sessionTable" class="badge">—</span></div>
            <div>Mesero: <span id="sessionOwner" class="badge">—</span></div>
            <div>Status: <span id="sessionStatus" class="muted">ABIERTA</span></div>
          </div>
          <div class="add-controls">
            <input id="prodNumber" placeholder="N° producto">
            <input id="prodQty" type="number" min="1" value="1">
            <button id="btnAddByNumber" class="btn primary">Agregar</button>
            <button id="btnAddManual" class="btn ghost">Agregar manual</button>
          </div>
          <div class="small muted">Productos:</div>
          <div class="small-scroll">
            <table id="productsTableSmall" class="striped">
              <thead><tr><th>#</th><th>Producto</th><th>Precio</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div style="margin-top:10px">
            <table id="cartTable" class="striped">
              <thead><tr><th>#</th><th>Producto</th><th>Cant</th><th>Valor</th><th>Total</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="totals">
            <div>Subtotal: <strong id="subtotal">$0</strong></div>
            <div>Propina: <input id="chkTip" type="checkbox" checked> <input id="tipPercent" type="number" min="0" value="10"> %</div>
            <div class="grand">Total: <strong id="grandTotal">$0</strong></div>
          </div>
          <div class="row">
            <button id="btnPrintTicket" class="btn primary">Imprimir Cuenta (POS)</button>
            <button id="btnCloseSession" class="btn ghost">Cerrar y marcar pagada</button>
            <button id="btnForceRelease" class="btn danger">Forzar liberar</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- ========================= MODAL: Selección de día ========================= -->
  <div id="modalDay" class="modal hidden">
    <div class="modal-box">
      <h3>Seleccione día de precios</h3>
      <label class="radio"><input type="radio" name="dayPrice" value="JVS.xlsx" checked> Día normal (JVS.xlsx)</label>
      <label class="radio"><input type="radio" name="dayPrice" value="DOMINGO.xlsx"> Domingo (DOMINGO.xlsx)</label>
      <div class="modal-actions">
        <button id="btnLoadPrices" class="btn primary">Cargar precios</button>
        <button id="btnCancelModal" class="btn ghost">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- ========================= SCRIPT ========================= -->
  <script>
  // (Este bloque incluye todas las funciones, reloj y carga Excel)
  // --- Usuarios, helpers, bindUI, login, renderTables, etc. ---
  // (Incluye las funciones ya corregidas que te pasé: startClock() y loadProductsFromExcel)
  </script>
</body>
</html>
