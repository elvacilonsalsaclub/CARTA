<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>El Vacilón Salsa Club</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>

  <!-- VIDEO DE FONDO -->
  <video autoplay muted loop id="bg-video">
    <source src="video_elvacilon1.mp4" type="video/mp4" />
  </video>

  <!-- CONTENEDOR LOGIN -->
  <div id="login-container">
    <img src="logo_elvacilon1.png" alt="Logo El Vacilón" class="logo">
    <h1>Bienvenido a El Vacilón Salsa Club</h1>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button onclick="login()">Ingresar</button>
    <footer>© 2025 El Vacilón Salsa Club — Todos los derechos reservados</footer>
  </div>

  <!-- PANEL PRINCIPAL -->
  <div id="main-panel" class="hidden">
    <header>
      <img src="logo_elvacilon1.png" class="panel-logo">
      <h2 id="panel-title">Panel</h2>
      <div id="panel-buttons" class="hidden">
        <button id="btn-select-prices" onclick="showModal()">Seleccione día de precios</button>
        <button id="btn-print-list" onclick="printList()">Imprimir lista de precios</button>
      </div>
      <button id="logout-btn" onclick="logout()">Cerrar sesión</button>
    </header>

    <main>
      <table id="product-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Producto</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </main>
  </div>

  <!-- MODAL SELECCIÓN DE PRECIOS -->
  <div id="modal-overlay" class="hidden">
    <div class="modal">
      <h2>Seleccione día de precios</h2>
      <label><input type="radio" name="day" value="JVS.xlsx" checked> Día Normal</label><br>
      <label><input type="radio" name="day" value="DOMINGO.xlsx"> Domingo</label><br><br>
      <button onclick="loadPrices()">Cargar precios</button>
      <button onclick="closeModal()">Cancelar</button>
    </div>
  </div>

  <script>
    const users = {
      mesero1: "123",
      mesero2: "456",
      mesero3: "789",
      mesero4: "101",
      cajera: "123456",
      administrador: "123456789"
    };

    let currentUser = "";
    let currentRole = "";
    let productList = [];

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();

      if (users[username] && users[username] === password) {
        currentUser = username;
        currentRole = username === "administrador" ? "admin" :
                      username === "cajera" ? "cajera" : "mesero";
        document.getElementById('login-container').classList.add('hidden');
        document.getElementById('main-panel').classList.remove('hidden');
        document.getElementById('panel-title').innerText = "Panel - " + username.toUpperCase();

        if (currentRole !== "admin") {
          document.getElementById('panel-buttons').classList.remove('hidden');
        }
      } else {
        alert("Usuario o contraseña incorrectos");
      }
    }

    function logout() {
      currentUser = "";
      document.getElementById('username').value = "";
      document.getElementById('password').value = "";
      document.getElementById('main-panel').classList.add('hidden');
      document.getElementById('login-container').classList.remove('hidden');
    }

    function showModal() {
      document.getElementById('modal-overlay').classList.remove('hidden');
    }

    function closeModal() {
      document.getElementById('modal-overlay').classList.add('hidden');
    }

    async function loadPrices() {
      const selectedFile = document.querySelector('input[name="day"]:checked').value;
      try {
        const response = await fetch(selectedFile);
        const data = await response.arrayBuffer();
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        productList = jsonData.slice(1).map((row, i) => ({
          id: i + 1,
          producto: row[0],
          valor: row[1]
        }));
        renderTable();
        closeModal();
      } catch (error) {
        alert("Error al cargar el archivo de precios.");
      }
    }

    function renderTable() {
      const tbody = document.querySelector("#product-table tbody");
      tbody.innerHTML = "";
      productList.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.id}</td>
          <td>${item.producto}</td>
          <td>$${Number(item.valor).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function printList() {
      if (productList.length === 0) {
        alert("Primero cargue una lista de precios.");
        return;
      }
      const printWindow = window.open("", "_blank");
      const date = new Date().toLocaleString();
      printWindow.document.write(`
        <html>
        <head>
          <title>Lista de Precios - El Vacilón Salsa Club</title>
          <style>
            body { font-family: Montserrat, sans-serif; margin: 30px; color: #000; }
            h1 { text-align: center; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #000; padding: 6px; text-align: left; }
            th { background: #eee; }
            .header { text-align: center; }
            .footer { margin-top: 20px; text-align: center; font-size: 14px; }
            img { width: 100px; }
          </style>
        </head>
        <body>
          <div class="header">
            <img src="logo_elvacilon1.png" alt="Logo">
            <h1>El Vacilón Salsa Club</h1>
            <p>Carrera 23a #7A - 15</p>
            <p>Cel: 3147159066 - 3136188889</p>
            <p>Instagram: @elvacilonclub</p>
            <p>Fecha de impresión: ${date}</p>
          </div>
          <table>
            <thead><tr><th>#</th><th>Producto</th><th>Valor</th></tr></thead>
            <tbody>
              ${productList.map(p => `<tr><td>${p.id}</td><td>${p.producto}</td><td>$${Number(p.valor).toLocaleString()}</td></tr>`).join("")}
            </tbody>
          </table>
          <div class="footer">
            <p>El Vacilón Salsa Club</p>
          </div>
        </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }
  </script>
</body>
</html>
