<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>El Vacilón Salsa Club</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

  <!-- VIDEO DE FONDO -->
  <video autoplay muted loop id="bgVideo">
    <source src="video_elvacilon1.mp4" type="video/mp4">
  </video>

  <!-- LOGIN -->
  <div id="loginScreen" class="login-container">
    <img src="logo_elvacilon1.png" alt="Logo" class="logo">
    <h1>Bienvenido a <span>El Vacilón Salsa Club</span></h1>
    <input id="inputUser" type="text" placeholder="Usuario">
    <input id="inputPass" type="password" placeholder="Contraseña">
    <button id="btnLogin">Ingresar</button>
  </div>

  <!-- APLICACIÓN -->
  <div id="app" class="hidden app-container">
    <div class="top-bar">
      <h2>El Vacilón Salsa Club</h2>
      <div id="userInfo"></div>
      <button id="btnLogout">Salir</button>
    </div>

    <div class="controls">
      <button id="btnSelectDay">Seleccionar día de precios</button>
      <button id="btnPrintPriceList">Imprimir lista de precios</button>
    </div>

    <div id="productsPanel" class="hidden">
      <h3>Lista de productos</h3>
      <input type="text" id="searchInput" placeholder="Buscar producto o número...">
      <table id="productsTable">
        <thead>
          <tr><th>#</th><th>Producto</th><th>Precio</th><th>Acción</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- MODAL DE SELECCIÓN DE PRECIOS -->
  <div id="modalDay" class="modal hidden">
    <div class="modal-content">
      <h3>Seleccione día de precios</h3>
      <label><input type="radio" name="dayPrice" value="JVS.xlsx" checked> Día Normal</label>
      <label><input type="radio" name="dayPrice" value="DOMINGO.xlsx"> Domingo</label>
      <div class="modal-buttons">
        <button id="btnLoadPrices">Cargar precios</button>
        <button id="btnCancelModal" class="cancel">Cancelar</button>
      </div>
    </div>
  </div>

  <footer>
    © 2025 El Vacilón Salsa Club — Carrera 23a # 7A - 15 — Cel: 3147159066 / 3136188889 — Instagram: @elvacilonclub
  </footer>

  <script>
    // ======== VARIABLES GLOBALES ========
    const USERS = {
      admin: '123456789',
      cajera: '123456',
      alex: '123',
      santiago: '456',
      mesero3: '3',
      mesero4: '4'
    };

    let currentUser = null;
    let role = null;
    let products = [];

    const $ = id => document.getElementById(id);
    const money = n => '$' + Number(n).toLocaleString();

    // ======== LOGIN ========
    $('btnLogin').addEventListener('click', () => {
      const user = $('inputUser').value.trim().toLowerCase();
      const pass = $('inputPass').value.trim();
      if (!USERS[user] || USERS[user] !== pass) {
        alert('Usuario o contraseña incorrectos');
        return;
      }
      currentUser = user;
      role = (user === 'admin') ? 'admin' : (user === 'cajera') ? 'cajera' : 'mesero';
      $('loginScreen').classList.add('hidden');
      $('app').classList.remove('hidden');
      $('userInfo').innerText = `Usuario: ${user} (${role})`;

      // Solo meseros y cajera ven el modal
      if (role !== 'admin') {
        setTimeout(() => $('modalDay').classList.remove('hidden'), 300);
      }
    });

    // ======== MODAL ========
    $('btnCancelModal').addEventListener('click', () => $('modalDay').classList.add('hidden'));

    $('btnLoadPrices').addEventListener('click', async () => {
      const selected = document.querySelector('input[name="dayPrice"]:checked').value;
      try {
        await loadExcel(selected);
        $('modalDay').classList.add('hidden');
        renderProducts();
        alert(`Precios cargados desde ${selected}`);
      } catch (e) {
        alert('Error al cargar archivo. Asegúrate que está en la misma carpeta.');
        console.error(e);
      }
    });

    // ======== CARGAR EXCEL ========
    async function loadExcel(file) {
      const res = await fetch(file);
      const ab = await res.arrayBuffer();
      const wb = XLSX.read(ab, { type: 'array' });
      const sheet = wb.Sheets[wb.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet, { defval: '' });
      products = json.map((row, i) => ({
        id: i + 1,
        nombre: row['producto'] || row['Producto'] || Object.values(row)[0],
        precio: row['valor'] || row['Valor'] || Object.values(row)[1]
      }));
    }

    // ======== MOSTRAR PRODUCTOS ========
    function renderProducts() {
      const tbody = $('productsTable').querySelector('tbody');
      tbody.innerHTML = '';
      products.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.nombre}</td>
          <td>${money(p.precio)}</td>
          <td><button>Agregar</button></td>`;
        tbody.appendChild(tr);
      });
      $('productsPanel').classList.remove('hidden');
    }

    // ======== IMPRIMIR LISTA DE PRECIOS ========
    $('btnPrintPriceList').addEventListener('click', () => {
      if (products.length === 0) return alert('Primero cargue la lista de precios');
      const fecha = new Date().toLocaleString();
      let filas = products.map(p => `<tr><td>${p.id}</td><td>${p.nombre}</td><td style="text-align:right">${money(p.precio)}</td></tr>`).join('');
      const html = `
      <html><head><title>Lista de Precios</title>
      <style>
        body { font-family: Montserrat, sans-serif; margin: 10px; color: #000; }
        h2 { text-align:center; }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        th,td { padding:4px; border-bottom:1px solid #ccc; }
        th { background:#f0d98a; }
        img { display:block; margin:0 auto; width:100px; }
        .meta { text-align:center; font-size:12px; }
      </style></head><body>
        <img src="logo_elvacilon1.png" alt="logo">
        <h2>El Vacilón Salsa Club</h2>
        <div class="meta">Carrera 23a #7A-15 — Cel: 3147159066 / 3136188889</div>
        <div class="meta">Instagram: @elvacilonclub</div>
        <div class="meta">Fecha: ${fecha}</div>
        <table><thead><tr><th>#</th><th>Producto</th><th>Valor</th></tr></thead><tbody>${filas}</tbody></table>
      </body></html>`;
      const w = window.open('', '_blank');
      w.document.write(html);
      w.document.close();
      w.print();
    });
  </script>
</body>
</html>
